# Обработка запросов(Лекции 10-13)
## 1) Обработка запросов. Преобразование SQL-выражения во внутреннее представление СУБД.
-   Обзор     
-   Меры стоимости запросов
-   Операция выборки
-   Сортировка
-   Операция соединения
-   Другие операции 
-   Вычисления выражений
## Основные шаги обработки: 
1. Парсинг и трансляция
2. Оптимизация
3. Вычисление
![slice-link](https://raw.githubusercontent.com/Sunaked/DataBase-Bilets/main/Exam/Bilets/images/1.png)
### Парсинг и трансляция
-   Осуществляется трансляция запроса в его внутреннюю форму. Затем осуществляется трансляция в реляционную алгебру.
-   Парсер осуществляет проверку синтаксиса и проверку отношений
### Вычисление
-   Механизм выполнения запросов принимает на вход план запросов, выполняет данный план, и возвращает ответ для запроса.
### Оптимизация
- Выражения реляционной алгебры могу иметь эквивалентные выражения
*Add here image*
-   Каждая операция реляционной алгебры может быть вычислена разными алгоритмами
-   Связанное выражение, уточняющее детальную стратегию выполнения называется планом вычислений (evaluation-plan)
	-   Используется индекс на salary, чтобы найти всех преподавателей с зп < 75000,
	-   Или производится полный скан(обход) отношения и убирает инструкторов с зп ≥ 75000
-   ***Оптимизация запросов***: Из всех эквивалентных планов выполнения выбирается с меньшей стоимостью. 
	-   Стоимость вычисляется с использованием статистической информации из каталога базы данных. 
		-   Например, число кортежей в каждом отношении, размер кортежей и т.д.   
## 2) Версионные методы управления транзакциями.
-   Основная идея версионных алгоритмов сериализации транзакций состоит в том, что в базе данных допускается существование нескольких «версий» одного и того же объекта.     
-   Эти алгоритмы, главным образом, направлены на преодоление конфликтов транзакций категорий R/W и W/R, позволяя выполнять операции чтения над некоторой предыдущей версией объекта базы данных. 
-   В результате операции чтения выполняются без задержек и тупиков, свойственных механизмам синхронизационных блокировок, а также без некоторых откатов, возможных при применении метода временных меток.**
### Версионный вариант метода временных меток
```
***Транзакция*** - это последовательность операций над БД, рассматриваемых СУБД как единое целое: либо все операции внутри транзакции выполняются, либо ни одна не выполняется. 
***Транзакция в SQL*** – это несколько последовательных инструкций SQL, которые вместе образуют логическую единицу работы (unit of work).
```
-   Multiversion Timestamp Ordering, MVTO
-   Порядок выполнения операций одновременно выполняемых транзакций задается порядком временных меток, которые получают транзакции во время старта.
-   Временные метки также используются для идентификации версий данных при чтении и модификации – каждая версия получает временную метку той транзакции, которая её записала.
-   Алгоритм не только следит за порядком выполнения операций транзакций, но также отвечает за преобразование операций над объектами базы данных в операции над версиями этих объектов, т.е. каждая операция над объектом базы данных o преобразуется в соответствующую операцию над некоторой версией объекта _o_.
Алгоритм MVTO работает следующим образом:
1.  Любая операция R_i(o) преобразуется в операцию R_i(ok), где ok – это версия объекта o, помеченная наибольшей временной меткой t(T_k), такой что t(T_k) ≤ t(T_i).
2.  Операция Wi(o) обрабатывается следующим образом:
 -   Если уже обработана операция R_j(ok), такая что t(T_k) ≤ t(T_i) < t(T_j), то операция W_i(o) отменяется, а транзакция T_i откатывается.
-   В противном случае W_i(o) преобразуется в W_i(o_i).
3.  Завершение (COMMIT) любой транзакции T откладывается до завершения всех транзакций, записавших версии объектов, которые прочитала T.